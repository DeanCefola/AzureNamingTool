@using AzNamingTool.Helpers
@using AzNamingTool.Models
@inject StateContainer state
@inject ProtectedSessionStorage session
@inject IJSRuntime JsRuntime
@inject ILogger<NavMenu> Logger

<div class="top-row ps-3 navbar navbar-dark">
    <div class="container-fluid">
        <a class="navbar-brand" href="/">Azure Naming Tool</a>
        <button title="Navigation menu" class="navbar-toggler" @onclick="ToggleNavMenu">
            <span class="navbar-toggler-icon"></span>
        </button>
    </div>
</div>

<div class="@NavMenuCssClass" @onclick="ToggleNavMenu">
    <nav class="flex-column">
        <div class="nav-item px-3">
            <NavLink class="nav-link" href="" Match="NavLinkMatch.All">
                <span class="oi oi-home" aria-hidden="true"></span> Home
            </NavLink>
        </div>
        <div class="nav-item px-3">
            <NavLink class="nav-link" href="instructions">
                <span class="oi oi-info" aria-hidden="true"></span> Instructions
            </NavLink>
        </div>
        <div class="nav-item px-3">
            <NavLink class="nav-link" href="configuration">
                <span class="oi oi-cog" aria-hidden="true"></span> Configuration
            </NavLink>
        </div>
        <div class="nav-item px-3">
            <NavLink class="nav-link" href="reference">
                <span class="oi oi-spreadsheet" aria-hidden="true"></span> Reference
            </NavLink>
        </div>
        <div class="nav-item px-3">
            <NavLink class="nav-link" href="generate">
                <span class="oi oi-plus" aria-hidden="true"></span> Generate
            </NavLink>
        </div>
        @if (PageType.ToString() == "AzNamingTool.Pages.Configuration")
        {
            <div class="card bg-transparent">
                <div class="card card-header bg-default text-white" style="font-weight:bold;">
                    Jump To
                </div>
                <div class="card bg-transparent py-3">
                    <div class="px-4">
                        <a class="text-decoration-none text-white" style="line-height:3em" @onclick='(() => OnConfigNavClick("ResourceComponent"))' @onclick:preventDefault href="">Components</a>
                    </div>
                    <div class="px-4">
                        <a class="text-decoration-none text-white" style="line-height:3em" @onclick='(() => OnConfigNavClick("ResourceDelimiter"))' @onclick:preventDefault href="">Delimiters</a>
                    </div>
                    @if (servicesData.ResourceComponents != null)
                    {
                        @foreach (ResourceComponent resourceComponent in servicesData.ResourceComponents.OrderBy(x => x.Name))
                        {
                            @if (resourceComponent.Name != "ResourceInstance")
                            {
                                <div class="px-4">
                                    <a class="text-decoration-none text-white" style="line-height:3em" @onclick='(() => OnConfigNavClick(resourceComponent.Name))' @onclick:preventDefault href="">@(resourceComponent.DisplayName)</a>
                                </div>
                            }
                        }
                    }
                </div>
            </div>
        }
        @if (PageType.ToString() == "AzNamingTool.Pages.Instructions")
        {
            <div class="card bg-transparent">
                <div class="card card-header bg-default text-white" style="font-weight:bold;">
                    Jump To
                </div>
                <div class="card bg-transparent py-3">
                    <div class="px-4">
                        <a class="text-decoration-none text-white" style="line-height:3em" @onclick='(() => OnConfigNavClick("overview"))' @onclick:preventDefault href="">Overview</a>
                    </div>
                    <div class="px-4">
                        <a class="text-decoration-none text-white" style="line-height:3em" @onclick='(() => OnConfigNavClick("step1"))' @onclick:preventDefault href="">Step 1</a>
                    </div>
                    <div class="px-4">
                        <a class="text-decoration-none text-white" style="line-height:3em" @onclick='(() => OnConfigNavClick("step2"))' @onclick:preventDefault href="">Step 2</a>
                    </div>
                    <div class="px-4">
                        <a class="text-decoration-none text-white" style="line-height:3em" @onclick='(() => OnConfigNavClick("step3"))' @onclick:preventDefault href="">Step 3</a>
                    </div>
                    <div class="px-4">
                        <a class="text-decoration-none text-white" style="line-height:3em" @onclick='(() => OnConfigNavClick("step4"))' @onclick:preventDefault href="">Step 4</a>
                    </div>
                </div>
            </div>
        }
    </nav>
</div>

@code {
    private bool collapseNavMenu = true;
    private ServicesData servicesData = new();
    private bool admin;

    private string? NavMenuCssClass => collapseNavMenu ? "collapse" : null;

    [Parameter]
    public Type PageType { get; set; }

    protected override async Task OnInitializedAsync()
    {
        // Load the values from state
        //admin = state.Admin;
        servicesData = await ServicesHelper.LoadServicesData(servicesData, false);
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        var result = await session.GetAsync<bool>("admin");
        admin = (bool)result.Value;
        servicesData = await ServicesHelper.LoadServicesData(servicesData, admin);
        StateHasChanged();
    }

    private void ToggleNavMenu()
    {
        collapseNavMenu = !collapseNavMenu;
    }

    private async void OnConfigNavClick(string e)
    {
        await JsRuntime.InvokeVoidAsync("scrollIntoView", e);
    }
}
