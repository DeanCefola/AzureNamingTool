@using AzNamingTool.Helpers
@using AzNamingTool.Models
@using AzNamingTool.Services
@inject IToastService toastService


<div class="modal fade show d-block" tabindex="-1" role="dialog">
    <div class="modal-backdrop fade show" @onclick="Cancel"></div>
    <div class="modal-dialog" style="z-index: 1050">
        <!-- Pop it above the backdrop -->
        <div class="modal-content">
            <div class="modal-header bg-info">
                <h3 class="modal-title text-white">Edit Resource Location</h3>
            </div>
            <div class="modal-body">
                <p>
                    Use the form below to update the resource location.
                </p>
                <p>
                </p>
                <div class="form-group">
                    <label for="resourcename">Location</label>
                    <input value="@locationName" type="text" disabled class="form-control" id="location" />
                </div>

                <div class="form-group">location
                    <label for="shortName">Short Name</label>
                    <input value="@locationShortName" type="text" class="form-control" id="shortname" @onchange="@((ui) => { locationShortName = (string)ui.Value;})" />
                </div>
            </div>
            <div class="modal-footer">
                <button @onclick="SaveResourceLocation" class="btn btn-primary">Submit</button>
                <button @onclick="ModalInstance.CancelAsync" class="btn btn-secondary">Cancel</button>
            </div>
        </div>
    </div>
</div>



@code {

    [CascadingParameter] BlazoredModalInstance ModalInstance { get; set; }

    [Parameter] public int resourceLocationId { get; set; }

    ResourceLocation resourceLocation { get; set; }

    private ServiceResponse serviceResponse = new();
    private string? locationName;
    private string? locationShortName;

    protected override async void OnInitialized()
    {
        serviceResponse = await ResourceLocationService.GetItem(resourceLocationId);
        resourceLocation = (ResourceLocation)serviceResponse.ResponseObject;
        locationName = resourceLocation.Name;
        locationShortName = resourceLocation.ShortName;
    }

    async void SaveResourceLocation()
    {
        resourceLocation.ShortName = locationShortName;
        serviceResponse = await ResourceLocationService.PostItem(resourceLocation);
        if (serviceResponse.Success)
        {
            ModalInstance.CloseAsync(ModalResult.Ok<ResourceLocation>(resourceLocation));
            toastService.ShowSuccess("Resource Location updated!", "SUCCESS");
        }
        else
        {
            toastService.ShowError("There was an error updating the Resource Location", "ERROR");
        }
    }


    async Task Cancel() => await ModalInstance.CancelAsync();

}